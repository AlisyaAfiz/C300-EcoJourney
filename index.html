<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoJourney CMS - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
        }

        .wrapper {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 250px;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            overflow: hidden;
        }

        .sidebar-header {
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 15px;
        }

        .sidebar-header h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #2ecc71;
        }

        .sidebar-header p {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-grow: 1;
            justify-content: flex-start;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover {
            background-color: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            transform: translateX(5px);
        }

        .nav-link.active {
            background-color: #2ecc71;
            color: white;
        }

        .sidebar-footer {
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            padding-top: 15px;
            margin-top: 15px;
            flex-shrink: 0;
        }

        .sidebar-footer .nav-link {
            color: #e74c3c;
        }

        .sidebar-footer .nav-link:hover {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
        }

        /* Main Content */
        .content {
            margin-left: 250px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Top Bar */
        .topbar {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid #ecf0f1;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .topbar-left h4 {
            color: #2c3e50;
            margin: 0;
            font-weight: 600;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2ecc71;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .user-details h6 {
            margin: 0;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .user-details small {
            color: #7f8c8d;
            font-size: 12px;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 30px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        /* Stat Cards */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            gap: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-left: 4px solid #2ecc71;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .stat-icon.primary {
            background: #3498db;
        }

        .stat-icon.success {
            background: #2ecc71;
        }

        .stat-icon.warning {
            background: #f39c12;
        }

        .stat-icon.danger {
            background: #e74c3c;
        }

        .stat-info h6 {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .stat-info h3 {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 20px;
            border: none;
        }

        .card-header h5 {
            margin: 0;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        /* Content List */
        .content-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
            transition: all 0.3s ease;
        }

        .content-item:hover {
            background-color: #f9f9f9;
        }

        .content-item:last-child {
            border-bottom: none;
        }

        .content-item-clickable {
            cursor: pointer;
        }

        .content-item-clickable:hover {
            background-color: #e8f5e9;
            transform: translateX(3px);
        }

        .content-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .content-meta {
            font-size: 12px;
            color: #7f8c8d;
        }

        /* Content Detail View */
        .content-detail-view {
            display: none;
        }

        .content-detail-view.active {
            display: block;
        }

        .detail-header {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .detail-header h2 {
            margin: 0 0 10px 0;
            font-size: 32px;
            font-weight: 700;
        }

        .detail-meta-row {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .detail-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-meta-item i {
            opacity: 0.8;
        }

        .detail-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .detail-section h4 {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-section p {
            color: #5a6c7d;
            line-height: 1.6;
        }

        .detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Preview Page Styles */
        .preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            overflow-y: auto;
        }

        .preview-overlay.show {
            display: flex;
        }

        .preview-container {
            background: white;
            border-radius: 12px;
            max-width: 1400px;
            width: 95%;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        .preview-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            padding: 20px;
            text-align: center;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .preview-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .preview-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .preview-logo {
            max-width: 200px;
            height: auto;
            margin: 0 auto 10px;
        }

        .preview-badge {
            display: inline-block;
            background: white;
            color: #2ecc71;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .preview-content {
            padding: 40px;
        }

        .preview-title {
            font-size: 36px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }

        .preview-media {
            margin-bottom: 30px;
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }

        .preview-media img,
        .preview-media video {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: block;
            margin: 0 auto;
        }

        .preview-description {
            font-size: 18px;
            line-height: 1.8;
            color: #5a6c7d;
            text-align: justify;
        }

        .preview-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #ecf0f1;
        }

        .preview-meta-item {
            text-align: center;
        }

        .preview-meta-item i {
            font-size: 24px;
            color: #2ecc71;
            margin-bottom: 5px;
        }

        .preview-meta-item strong {
            display: block;
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .preview-meta-item span {
            display: block;
            font-size: 16px;
            color: #2c3e50;
            font-weight: 600;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Delete Button */
        .delete-btn {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 16px;
            margin-left: 10px;
        }

        .delete-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
            transform: scale(1.1);
        }

        .content-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Custom Success Popup */
        .success-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .success-popup-overlay.show {
            display: flex;
        }

        .success-popup {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        .success-popup-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleUp 0.5s ease;
        }

        .success-popup-icon i {
            color: white;
            font-size: 40px;
        }

        .success-popup h3 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .success-popup p {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 25px;
        }

        .success-popup-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .success-popup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }

        /* Custom Confirmation Popup */
        .confirm-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .confirm-popup-overlay.show {
            display: flex;
        }

        .confirm-popup {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 420px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
        }

        .confirm-popup-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleUp 0.5s ease;
        }

        .confirm-popup-icon i {
            color: white;
            font-size: 40px;
        }

        .confirm-popup h3 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .confirm-popup p {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 25px;
        }

        .confirm-popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-popup-btn {
            padding: 12px 35px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .confirm-popup-btn.yes {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .confirm-popup-btn.yes:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .confirm-popup-btn.no {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .confirm-popup-btn.no:hover {
            background: #bdc3c7;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleUp {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* Buttons */
        .btn-primary {
            background: #2ecc71;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        /* Tabs */
        .nav-tabs {
            border-bottom: 2px solid #ecf0f1;
        }

        .nav-tabs .nav-link {
            color: #7f8c8d;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            color: #2ecc71;
        }

        .nav-tabs .nav-link.active {
            color: #2ecc71;
            border-bottom-color: #2ecc71;
            background: none;
        }

        /* Category Badges */
        .category-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-badge:hover {
            transform: scale(1.05);
        }

        .env {
            background: #d4edda;
            color: #155724;
        }

        .social {
            background: #d1ecf1;
            color: #0c5460;
        }

        .gov {
            background: #fff3cd;
            color: #856404;
        }

        .econ {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 15px;
            }

            .content {
                margin-left: 0;
            }

            .wrapper {
                flex-direction: column;
            }

            .main-content {
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-leaf"></i> EcoJourney</h3>
                <p>Content Management System</p>
            </div>

            <div class="nav">
                <a id="nav-dashboard" class="nav-link active" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </a>
                <a id="nav-content" class="nav-link" onclick="switchTab('content')">
                    <i class="fas fa-file-upload"></i> My Content
                </a>
                <a id="nav-approvals" class="nav-link" onclick="switchTab('approvals')">
                    <i class="fas fa-check-circle"></i> Approvals
                    <span class="badge bg-warning text-dark ms-2">3</span>
                </a>
                <a id="nav-admin" class="nav-link" onclick="switchTab('admin')">
                    <i class="fas fa-cog"></i> Administration
                </a>
                <a id="nav-notifications" class="nav-link" onclick="switchTab('notifications')" style="display: none;">
                    <i class="fas fa-bell"></i> Notifications
                    <span id="notification-count" class="badge bg-warning text-dark ms-2" style="display: none;">3</span>
                </a>
                <a id="nav-profile" class="nav-link" onclick="switchTab('profile')">
                    <i class="fas fa-user"></i> Profile
                </a>
            </div>

            <div class="sidebar-footer">
                <a class="nav-link" onclick="handleLogout(event)">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Top Navigation Bar -->
            <nav class="topbar">
                <div class="topbar-left">
                    <h4 id="page-title">Dashboard</h4>
                </div>

                <div class="topbar-right">
                    <div class="user-info">
                        <div class="user-avatar">A</div>
                        <div class="user-details">
                            <h6>Tom Smith</h6>
                            <small class="profile-role">Administrator</small>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <div class="main-content">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content-area" style="display: block;">
                    <h1 class="page-title">Welcome to EcoJourney CMS</h1>
                    <p class="page-subtitle">Manage your environmental, social, and governance content</p>

                    <div class="row mb-4">
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-icon primary">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="stat-info">
                                    <h6>Total Content</h6>
                                    <h3>24</h3>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-icon success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <h6>Approved</h6>
                                    <h3>18</h3>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-icon warning">
                                    <i class="fas fa-hourglass-end"></i>
                                </div>
                                <div class="stat-info">
                                    <h6>Pending</h6>
                                    <h3>3</h3>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-icon danger">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <h6>Rejected</h6>
                                    <h3>2</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-history"></i> Recent Content</h5>
                                </div>
                                <div class="card-body" id="recent-content-container">
                                    <div class="content-item">
                                        <div>
                                            <div class="content-title">Solar Energy Initiative</div>
                                            <div class="content-meta">Created: Dec 20, 2025 | Category: Environmental
                                            </div>
                                        </div>
                                        <span class="badge badge-success">Approved</span>
                                    </div>
                                    <div class="content-item">
                                        <div>
                                            <div class="content-title">Community Outreach Program</div>
                                            <div class="content-meta">Created: Dec 19, 2025 | Category: Social</div>
                                        </div>
                                        <span class="badge badge-warning">Pending</span>
                                    </div>
                                    <div class="content-item">
                                        <div>
                                            <div class="content-title">Corporate Governance Report</div>
                                            <div class="content-meta">Created: Dec 18, 2025 | Category: Governance</div>
                                        </div>
                                        <span class="badge badge-success">Approved</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-folder"></i> Content by Category</h5>
                                </div>
                                <div class="card-body" style="text-align: center;">
                                    <div style="margin-bottom: 15px;">
                                        <span class="category-badge env">Environmental (8)</span>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <span class="category-badge social">Social (7)</span>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <span class="category-badge gov">Governance (6)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div id="content" class="tab-content-area" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h1 class="page-title">My Content</h1>
                        <button class="btn btn-primary" onclick="showUploadForm()">
                            <i class="fas fa-upload"></i> Upload Content
                        </button>
                    </div>

                    <div class="card" id="content-list">
                        <div class="card-header">
                            <h5>Your Content</h5>
                        </div>
                        <div class="card-body" id="content-items-container">
                            <div class="content-item content-item-clickable" data-id="default-1"
                                data-title="Wind Energy Project" data-type="Video" data-size="125 MB"
                                data-date="Dec 17, 2025" data-status="Published" data-category="Environmental"
                                data-description="Comprehensive video documentation of our latest wind energy project, showcasing the installation and benefits of renewable energy infrastructure. This project demonstrates our commitment to sustainable energy solutions and reducing carbon emissions."
                                onclick="viewContentDetail(this)">
                                <div>
                                    <div class="content-title">Wind Energy Project</div>
                                    <div class="content-meta">Video | 125 MB | Modified: Dec 17, 2025</div>
                                </div>
                                <div class="content-item-actions">
                                    <span class="badge badge-success">Published</span>
                                    <button class="delete-btn"
                                        onclick="event.stopPropagation(); deleteContent('default-1')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="content-item content-item-clickable" data-id="default-2"
                                data-title="Biodiversity Report 2024" data-type="Document" data-size="3.2 MB"
                                data-date="Dec 16, 2025" data-status="Pending" data-category="Environmental"
                                data-description="Annual biodiversity assessment report documenting local ecosystem health, species population trends, and conservation efforts. This report includes detailed analysis of flora and fauna in protected areas and recommendations for future conservation strategies."
                                onclick="viewContentDetail(this)">
                                <div>
                                    <div class="content-title">Biodiversity Report 2024</div>
                                    <div class="content-meta">Document | 3.2 MB | Modified: Dec 16, 2025</div>
                                </div>
                                <div class="content-item-actions">
                                    <span class="badge badge-warning">Pending</span>
                                    <button class="delete-btn"
                                        onclick="event.stopPropagation(); deleteContent('default-2')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="content-item content-item-clickable" data-id="default-3"
                                data-title="Carbon Offset Initiative" data-type="Article" data-size="256 KB"
                                data-date="Dec 15, 2025" data-status="Approved" data-category="Environmental"
                                data-description="Detailed article about our carbon offset program, including methodologies for calculating carbon footprint, offset strategies, and partnerships with reforestation projects. This initiative aims to achieve carbon neutrality by 2030."
                                onclick="viewContentDetail(this)">
                                <div>
                                    <div class="content-title">Carbon Offset Initiative</div>
                                    <div class="content-meta">Article | 256 KB | Modified: Dec 15, 2025</div>
                                </div>
                                <div class="content-item-actions">
                                    <span class="badge badge-success">Approved</span>
                                    <button class="delete-btn"
                                        onclick="event.stopPropagation(); deleteContent('default-3')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Form Section -->
                    <div id="upload-form-section" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-upload"></i> Upload New Content</h5>
                            </div>
                            <div class="card-body">
                                <form id="upload-form">
                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Title</label>
                                        <input type="text" class="form-control" id="content-title" required
                                            placeholder="Enter content title">
                                    </div>

                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Description</label>
                                        <textarea class="form-control" id="content-description" rows="4" required
                                            placeholder="Enter content description"></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Category</label>
                                        <select class="form-control" id="content-category" required>
                                            <option value="">Select a category</option>
                                            <option value="Environmental">Environmental</option>
                                            <option value="Social">Social</option>
                                            <option value="Governance">Governance</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Media File
                                            (Image/Video)</label>
                                        <input type="file" class="form-control" id="content-media"
                                            accept="image/*,video/*" required>
                                        <small style="color: #7f8c8d; display: block; margin-top: 5px;">Upload an image
                                            or video to display for this project</small>
                                    </div>

                                    <div class="mb-3">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Project
                                            Document</label>
                                        <input type="file" class="form-control" id="content-file" required>
                                        <small style="color: #7f8c8d; display: block; margin-top: 5px;">Upload project
                                            details (PDF, DOC, DOCX, etc. - Max 500MB)</small>
                                    </div>

                                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-upload"></i> Upload Content
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="hideUploadForm()"
                                            style="background: #7f8c8d;">
                                            <i class="fas fa-arrow-left"></i> Back
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Content Detail View -->
                    <div id="content-detail-view" class="content-detail-view">
                        <button class="btn btn-primary" onclick="backToContentList()"
                            style="margin-bottom: 20px; background: #7f8c8d;">
                            <i class="fas fa-arrow-left"></i> Back to My Content
                        </button>

                        <div class="detail-header">
                            <h2 id="detail-title">Content Title</h2>
                            <div class="detail-meta-row">
                                <div class="detail-meta-item">
                                    <i class="fas fa-file"></i>
                                    <span id="detail-type">Document</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-hdd"></i>
                                    <span id="detail-size">0 KB</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    <span id="detail-date">-</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-tag"></i>
                                    <span id="detail-category">-</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-info-circle"></i>
                                    <span id="detail-status">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Media Preview Section -->
                        <div id="detail-media-preview" class="detail-section" style="display: none;">
                            <h4><i class="fas fa-image"></i> Media Preview</h4>
                            <div style="text-align: center; padding: 20px;">
                                <img id="detail-image-preview"
                                    style="max-width: 100%; max-height: 500px; border-radius: 8px; display: none; margin: 0 auto;" />
                                <video id="detail-video-preview" controls
                                    style="max-width: 100%; max-height: 500px; border-radius: 8px; display: none; margin: 0 auto;"></video>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4><i class="fas fa-align-left"></i> Description</h4>
                            <p id="detail-description">No description available.</p>
                        </div>

                        <div class="detail-section">
                            <h4><i class="fas fa-info-circle"></i> File Information</h4>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <strong>Content ID:</strong>
                                    <p id="detail-id" style="margin: 5px 0;">-</p>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <strong>File Format:</strong>
                                    <p id="detail-format" style="margin: 5px 0;">-</p>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <strong>Upload Date:</strong>
                                    <p id="detail-upload-date" style="margin: 5px 0;">-</p>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <strong>Status:</strong>
                                    <p id="detail-status-info" style="margin: 5px 0;">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="detail-actions">
                            <button class="btn btn-primary" onclick="downloadCurrentContent()">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn btn-primary" style="background: #9b59b6;" onclick="previewContent()">
                                <i class="fas fa-eye"></i> Preview
                            </button>
                            <button class="btn btn-primary" style="background: #3498db;" onclick="editCurrentContent()">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-primary" style="background: #e74c3c;"
                                onclick="deleteCurrentContent()">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>

                    <!-- Content Edit Form -->
                    <div id="content-edit-form" class="content-detail-view">
                        <button class="btn btn-primary" onclick="cancelEdit()"
                            style="margin-bottom: 20px; background: #7f8c8d;">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </button>

                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-edit"></i> Edit Content</h5>
                            </div>
                            <div class="card-body">
                                <form id="edit-content-form">
                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Title</label>
                                        <input type="text" class="form-control" id="edit-title" required
                                            placeholder="Enter content title">
                                    </div>

                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Description</label>
                                        <textarea class="form-control" id="edit-description" rows="6" required
                                            placeholder="Enter content description"></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Category</label>
                                        <select class="form-control" id="edit-category" required>
                                            <option value="">Select a category</option>
                                            <option value="Environmental">Environmental</option>
                                            <option value="Social">Social</option>
                                            <option value="Governance">Governance</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Replace
                                            Media File (Optional)</label>
                                        <input type="file" class="form-control" id="edit-media"
                                            accept="image/*,video/*">
                                        <small style="color: #7f8c8d; display: block; margin-top: 5px;">Leave empty to
                                            keep current media. Upload new image/video to replace it.</small>
                                        <!-- Current Media Preview -->
                                        <div id="edit-current-media"
                                            style="margin-top: 15px; text-align: center; display: none;">
                                            <strong style="display: block; margin-bottom: 10px;">Current Media:</strong>
                                            <img id="edit-current-image"
                                                style="max-width: 100%; max-height: 300px; border-radius: 8px; display: none; margin: 0 auto;" />
                                            <video id="edit-current-video" controls
                                                style="max-width: 100%; max-height: 300px; border-radius: 8px; display: none; margin: 0 auto;"></video>
                                        </div>
                                        <!-- New Media Preview -->
                                        <div id="edit-new-media-preview"
                                            style="margin-top: 15px; text-align: center; display: none;">
                                            <strong style="display: block; margin-bottom: 10px; color: #2ecc71;">New
                                                Media Preview:</strong>
                                            <img id="edit-new-image"
                                                style="max-width: 100%; max-height: 300px; border-radius: 8px; display: none; margin: 0 auto;" />
                                            <video id="edit-new-video" controls
                                                style="max-width: 100%; max-height: 300px; border-radius: 8px; display: none; margin: 0 auto;"></video>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Replace
                                            Project Document (Optional)</label>
                                        <input type="file" class="form-control" id="edit-file">
                                        <small style="color: #7f8c8d; display: block; margin-top: 5px;">Leave empty to
                                            keep current document. Upload new file to replace it.</small>
                                        <div id="current-file-info"
                                            style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; display: none;">
                                            <strong>Current document:</strong> <span id="current-file-display"></span>
                                        </div>
                                    </div>

                                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> Save Changes
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="cancelEdit()"
                                            style="background: #7f8c8d;">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="notifications" class="tab-content-area" style="display: none;">
                    <h1 class="page-title">Notifications</h1>

                    <div class="card">
                        <div class="card-body">

                            <!-- Approval Notification -->
                            <div class="content-item">
                                <div>
                                    <div class="content-title">
                                        <i class="fas fa-check-circle text-success"></i>
                                        Content Approved
                                    </div>
                                    <div class="content-meta">
                                        Your <strong>Carbon Offset Initiative</strong> has been approved.
                                    </div>
                                    <small class="text-muted">2 hours ago</small>
                                </div>
                                <span class="badge badge-success">New</span>
                            </div>

                            <!-- Manager Feedback Notification -->
                            <div class="content-item">
                                <div>
                                    <div class="content-title">
                                        <i class="fas fa-comment-dots text-warning"></i>
                                        Feedback Received
                                    </div>
                                    <div class="content-meta">
                                        <strong>Biodiversity Report 2024: </strong>Please revise the introduction section to include updated 2025 emissions data.
                                    </div>
                                    <small class="text-muted">
                                        5 hours ago
                                    </small>
                                </div>
                                <span class="badge badge-warning">Action Required</span>
                            </div>

                            <!-- Rejection Notification -->
                            <div class="content-item">
                                <div>
                                    <div class="content-title">
                                        <i class="fas fa-times-circle text-danger"></i>
                                        Content Rejected
                                    </div>
                                    <div class="content-meta">
                                        <strong>Community Outreach Program</strong> was rejected. This content does not align with our guidelines.
                                    </div>
                                    <small class="text-muted">1 day ago</small>
                                </div>
                                <span class="badge badge-danger">Rejected</span>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Approvals Tab with Review Functionality -->
                <div id="approvals" class="tab-content-area" style="display: none;">
                    <h1 class="page-title">Content Approval Queue</h1>
                    <p class="page-subtitle">Review and approve pending content submissions</p>

                    <!-- Approvals List View -->
                    <div id="approvals-list" style="display: block;">
                        <div class="card">
                            <div class="card-header">
                                <h5>Pending Approvals (<span id="pending-count">3</span>)</h5>
                            </div>
                            <div class="card-body" id="approvals-container">
                                <div class="content-item" data-id="pending-1" data-title="Community Outreach Program"
                                    data-author="John Doe" data-date="Dec 19, 2025" data-category="Social"
                                    data-description="A comprehensive community outreach initiative designed to engage local residents in environmental sustainability projects. This program includes educational workshops, volunteer opportunities, and partnerships with local organizations to promote social responsibility and community engagement."
                                    data-status="Pending">
                                    <div>
                                        <div class="content-title">Community Outreach Program</div>
                                        <div class="content-meta">Submitted by: John Doe | Dec 19, 2025 | Category:
                                            Social</div>
                                    </div>
                                    <button class="btn btn-primary"
                                        onclick="event.stopPropagation(); openReviewPage(document.querySelector('[data-id=\'pending-1\']'))"
                                        style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </div>
                                <div class="content-item" data-id="pending-2" data-title="Water Conservation Plan"
                                    data-author="Jane Smith" data-date="Dec 19, 2025" data-category="Environmental"
                                    data-description="A detailed water conservation strategy outlining methods to reduce water consumption across our operations and facilities. The plan includes rainwater harvesting systems, water recycling technologies, and employee awareness programs to promote sustainable water usage practices."
                                    data-status="Pending">
                                    <div>
                                        <div class="content-title">Water Conservation Plan</div>
                                        <div class="content-meta">Submitted by: Jane Smith | Dec 19, 2025 | Category:
                                            Environmental</div>
                                    </div>
                                    <button class="btn btn-primary"
                                        onclick="event.stopPropagation(); openReviewPage(document.querySelector('[data-id=\'pending-2\']'))"
                                        style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </div>
                                <div class="content-item" data-id="pending-3"
                                    data-title="Ethical Supply Chain Standards" data-author="Mike Johnson"
                                    data-date="Dec 18, 2025" data-category="Governance"
                                    data-description="Comprehensive governance framework establishing ethical standards for our entire supply chain. Includes vendor compliance requirements, fair labor practices, conflict minerals policies, and regular audit procedures to ensure all suppliers meet our sustainability and ethical standards."
                                    data-status="Pending">
                                    <div>
                                        <div class="content-title">Ethical Supply Chain Standards</div>
                                        <div class="content-meta">Submitted by: Mike Johnson | Dec 18, 2025 | Category:
                                            Governance</div>
                                    </div>
                                    <button class="btn btn-primary"
                                        onclick="event.stopPropagation(); openReviewPage(document.querySelector('[data-id=\'pending-3\']'))"
                                        style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Review Page View -->
                    <div id="review-page" style="display: none;">
                        <button class="btn btn-primary" onclick="closeReviewPage()"
                            style="margin-bottom: 20px; background: #7f8c8d;">
                            <i class="fas fa-arrow-left"></i> Back to Approvals
                        </button>

                        <div class="detail-header">
                            <h2 id="review-title">Content Title</h2>
                            <div class="detail-meta-row">
                                <div class="detail-meta-item">
                                    <i class="fas fa-user"></i>
                                    <span id="review-author">Author Name</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    <span id="review-date">-</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-tag"></i>
                                    <span id="review-category">-</span>
                                </div>
                                <div class="detail-meta-item">
                                    <i class="fas fa-info-circle"></i>
                                    <span id="review-status"
                                        style="background: #f39c12; color: white; padding: 4px 10px; border-radius: 12px;">Pending</span>
                                </div>
                            </div>
                        </div>

                        <!-- Media Preview Section -->
                        <div id="review-media-section" class="detail-section" style="display: none;">
                            <h4><i class="fas fa-image"></i> Media Preview</h4>
                            <div style="text-align: center; padding: 20px;">
                                <img id="review-image"
                                    style="max-width: 100%; max-height: 500px; border-radius: 8px; display: none; margin: 0 auto;" />
                                <video id="review-video" controls
                                    style="max-width: 100%; max-height: 500px; border-radius: 8px; display: none; margin: 0 auto;"></video>
                                <div id="review-no-media" style="color: #7f8c8d; padding: 40px; display: none;">
                                    <i class="fas fa-image" style="font-size: 48px; margin-bottom: 10px;"></i>
                                    <p>No media available for preview</p>
                                </div>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4><i class="fas fa-align-left"></i> Description</h4>
                            <p id="review-description">No description available.</p>
                        </div>

                        <div class="detail-section">
                            <h4><i class="fas fa-comments"></i> Manager Review & Comments</h4>
                            <textarea id="review-comments" class="form-control" rows="5"
                                placeholder="Add your review comments, feedback, or reasons for approval/rejection..."></textarea>
                        </div>

                        <div class="detail-section">
                            <h4><i class="fas fa-file-alt"></i> Additional Notes</h4>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; color: #5a6c7d;">
                                <p><strong>Submission Status:</strong> <span id="review-submission-status">Awaiting
                                        Review</span></p>
                                <p><strong>Submitted Date:</strong> <span id="review-submitted-date">-</span></p>
                                <p style="margin-bottom: 0;"><strong>Submitted By:</strong> <span
                                        id="review-submitted-by">-</span></p>
                            </div>
                        </div>

                        <!-- Review Actions -->
                        <div class="detail-section">
                            <h4><i class="fas fa-tasks"></i> Review Decision</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" style="background: #27ae60; flex: 1; min-width: 150px;"
                                    onclick="submitReview('approved')">
                                    <i class="fas fa-check"></i> Approve Content
                                </button>
                                <button class="btn btn-primary" style="background: #f39c12; flex: 1; min-width: 150px;"
                                    onclick="submitReview('changes_requested')">
                                    <i class="fas fa-edit"></i> Request Changes
                                </button>
                                <button class="btn btn-primary" style="background: #e74c3c; flex: 1; min-width: 150px;"
                                    onclick="submitReview('rejected')">
                                    <i class="fas fa-times"></i> Reject Content
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    let currentReviewingContent = null;

                    function openReviewPage(element) {
                        currentReviewingContent = {
                            id: element.dataset.id || 'unknown',
                            title: element.dataset.title || 'No Title',
                            author: element.dataset.author || 'Unknown Author',
                            date: element.dataset.date || '-',
                            category: element.dataset.category || 'General',
                            description: element.dataset.description || 'No description available.',
                            status: element.dataset.status || 'Pending'
                        };

                        console.log('Opening review for:', currentReviewingContent);

                        // Populate review page with content data
                        document.getElementById('review-title').textContent = currentReviewingContent.title;
                        document.getElementById('review-author').textContent = currentReviewingContent.author;
                        document.getElementById('review-date').textContent = currentReviewingContent.date;
                        document.getElementById('review-category').textContent = currentReviewingContent.category;
                        document.getElementById('review-status').textContent = currentReviewingContent.status;
                        document.getElementById('review-description').textContent = currentReviewingContent.description;
                        document.getElementById('review-submitted-by').textContent = currentReviewingContent.author;
                        document.getElementById('review-submitted-date').textContent = currentReviewingContent.date;
                        document.getElementById('review-submission-status').textContent = 'Awaiting Review';
                        document.getElementById('review-comments').value = '';

                        // Hide approvals list, show review page
                        document.getElementById('approvals-list').style.display = 'none';
                        document.getElementById('review-page').style.display = 'block';

                        // Scroll to top
                        window.scrollTo(0, 0);
                    }

                    function closeReviewPage() {
                        document.getElementById('approvals-list').style.display = 'block';
                        document.getElementById('review-page').style.display = 'none';
                        currentReviewingContent = null;
                    }

                    async function fetchContentForReview(contentId) {
                        try {
                            const API_URL = 'https://rpecocjourney-backend.onrender.com';
                            const response = await fetch(`${API_URL}/api/content/${contentId}`);

                            if (response.ok) {
                                const editForm = document.getElementById('edit-content-form');
                                if (editForm) {
                                    editForm.addEventListener('submit', async (event) => {
                                        event.preventDefault();

                                        try {
                                            const title = document.getElementById('edit-title').value;
                                            const description = document.getElementById('edit-description').value;
                                            const category = document.getElementById('edit-category').value;
                                            const newMediaFile = document.getElementById('edit-media').files[0];
                                            const newDocFile = document.getElementById('edit-file').files[0];

                                            // 1. Get the CURRENTLY stored data first so we don't lose the image
                                            const contents = await getStoredContents();
                                            const existingItem = contents.find(c => c.id === currentViewingContentId);

                                            const updatedData = {
                                                ...existingItem, // Start with everything we already have
                                                title: title,
                                                description: description,
                                                category: category,
                                                date: new Date().toISOString() // Update the modified timestamp
                                            };

                                            // 2. ONLY if a new media file is selected, overwrite the mediaData
                                            if (newMediaFile) {
                                                const mediaData = await new Promise((resolve, reject) => {
                                                    const reader = new FileReader();
                                                    reader.onload = (e) => resolve(e.target.result);
                                                    reader.onerror = () => reject(new Error('Failed to read media file'));
                                                    reader.readAsDataURL(newMediaFile);
                                                });

                                                updatedData.mediaFileName = newMediaFile.name;
                                                updatedData.mediaFileType = newMediaFile.type;
                                                updatedData.mediaData = mediaData;
                                            }

                                            // 3. ONLY if a new doc is selected, overwrite doc info
                                            if (newDocFile) {
                                                const fileData = await new Promise((resolve, reject) => {
                                                    const reader = new FileReader();
                                                    reader.onload = (e) => resolve(e.target.result);
                                                    reader.onerror = () => reject(new Error('Failed to read document file'));
                                                    reader.readAsDataURL(newDocFile);
                                                });

                                                updatedData.fileName = newDocFile.name;
                                                updatedData.fileType = newDocFile.type;
                                                updatedData.fileData = fileData;
                                                updatedData.fileSize = newDocFile.size;
                                            }

                                            // 4. Save the fully merged object
                                            await updateContentData(currentViewingContentId, updatedData);

                                            showSuccessPopup('Content updated successfully!');
                        
                                            // UI Refresh
                                            document.getElementById('content-edit-form').style.display = 'none';
                                            document.getElementById('content-detail-view').style.display = 'block';

                                        } catch (error) {
                                            console.error('Update failed:', error);
                                            alert('Update failed: ' + error.message);
                                        }
                                    });
                                }
                        // Update the badge in sidebar navigation
                        const approvalsNav = document.getElementById('nav-approvals');
                        const badge = approvalsNav.querySelector('.badge');
                        if (badge) {
                            badge.textContent = pendingCount;
                            if (pendingCount === 0) {
                                badge.style.display = 'none';
                            }
                        }

                        if (pendingCount === 0) {
                            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #7f8c8d;"><i class="fas fa-check-circle" style="font-size: 48px; margin-bottom: 10px;"></i><p>All content has been reviewed!</p></div>';
                        }
                    }

                    // Update dashboard statistics
                    function updateDashboardStats(decision) {
                        // Get all stat cards
                        const statCards = document.querySelectorAll('.stat-card');

                        if (statCards.length >= 4) {
                            // Index 0 = Total, 1 = Approved, 2 = Pending, 3 = Rejected
                            const totalStat = statCards[0].querySelector('.stat-info h3');
                            const approvedStat = statCards[1].querySelector('.stat-info h3');
                            const pendingStat = statCards[2].querySelector('.stat-info h3');
                            const rejectedStat = statCards[3].querySelector('.stat-info h3');

                            if (totalStat && approvedStat && pendingStat && rejectedStat) {
                                let total = parseInt(totalStat.textContent) || 0;
                                let approved = parseInt(approvedStat.textContent) || 0;
                                let pending = parseInt(pendingStat.textContent) || 0;
                                let rejected = parseInt(rejectedStat.textContent) || 0;

                                // Update counts based on decision
                                if (decision === 'approved') {
                                    approved++;
                                    pending = Math.max(0, pending - 1);
                                } else if (decision === 'rejected') {
                                    rejected++;
                                    pending = Math.max(0, pending - 1);
                                } else if (decision === 'changes_requested') {
                                    pending = Math.max(0, pending - 1);
                                }

                                // Update display
                                totalStat.textContent = total;
                                approvedStat.textContent = approved;
                                pendingStat.textContent = pending;
                                rejectedStat.textContent = rejected;

                                console.log('Dashboard updated - Approved:', approved, 'Pending:', pending, 'Rejected:', rejected);
                            }
                        }

                        // Update the Recent Content badge for the reviewed item
                        updateRecentContentBadge(decision);
                    }

                    // Update badge in Recent Content section
                    function updateRecentContentBadge(decision) {
                        if (!currentReviewingContent) return;

                        const dashboardCards = document.querySelectorAll('.card');
                        let recentContentCard = null;

                        // Find the "Recent Content" card
                        dashboardCards.forEach(card => {
                            const header = card.querySelector('.card-header h5');
                            if (header && header.textContent.includes('Recent Content')) {
                                recentContentCard = card;
                            }
                        });

                        if (!recentContentCard) return;

                        const cardBody = recentContentCard.querySelector('.card-body');
                        if (!cardBody) return;

                        // Find the content item matching the approved content
                        const contentItems = cardBody.querySelectorAll('.content-item');
                        contentItems.forEach(item => {
                            const titleElement = item.querySelector('.content-title');
                            if (titleElement && titleElement.textContent.trim() === currentReviewingContent.title.trim()) {
                                // Found it! Update the badge
                                const badge = item.querySelector('.badge');
                                if (badge) {
                                    // Remove old classes
                                    badge.classList.remove('badge-success', 'badge-warning', 'badge-danger');

                                    // Add new class and text based on decision
                                    if (decision === 'approved') {
                                        badge.classList.add('badge-success');
                                        badge.textContent = 'Approved';
                                    } else if (decision === 'rejected') {
                                        badge.classList.add('badge-danger');
                                        badge.textContent = 'Rejected';
                                    } else if (decision === 'changes_requested') {
                                        badge.classList.add('badge-warning');
                                        badge.textContent = 'Changes Requested';
                                    }

                                    console.log('Updated Recent Content badge for:', currentReviewingContent.title);
                                }
                            }
                        });
                    }
                    
                    const navNotifications = document.getElementById('nav-notifications');
                    const badge = document.getElementById('notification-count');
                    const notifications = 3; // replace with your real notification count

                    if (notifications > 0) {
                        navNotifications.style.display = 'block';  // show the link
                        badge.style.display = 'inline-block';      // show the badge
                        badge.textContent = notifications;         // set the count
                    } else {
                        navNotifications.style.display = 'none';   // hide link if no notifications
                    }

                </script>

                <!-- Admin Tab -->
                <div id="admin" class="tab-content-area" style="display: none;">
                    <h1 class="page-title">Administration Panel</h1>

                    <div style="margin-bottom: 20px;">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" onclick="switchAdminTab('users')">
                                    <i class="fas fa-users"></i> Users (12)
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="switchAdminTab('categories')">
                                    <i class="fas fa-folder"></i> Categories (4)
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="switchAdminTab('settings')">
                                    <i class="fas fa-sliders-h"></i> Settings
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div id="admin-users" style="display: block;">
                        <div class="card">
                            <div class="card-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h5 style="margin: 0;">User Management</h5>
                                    <button class="btn btn-primary" style="font-size: 12px;">+ Add User</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="content-item">
                                    <div>
                                        <div class="content-title">Tom Smith</div>
                                        <div class="content-meta">tom@ecojourney.com | Administrator</div>
                                    </div>
                                    <span
                                        style="background: #2ecc71; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px;">Active</span>
                                </div>
                                <div class="content-item">
                                    <div>
                                        <div class="content-title">John Doe</div>
                                        <div class="content-meta">john@ecojourney.com | Content Producer</div>
                                    </div>
                                    <span
                                        style="background: #2ecc71; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px;">Active</span>
                                </div>
                                <div class="content-item">
                                    <div>
                                        <div class="content-title">Jane Smith</div>
                                        <div class="content-meta">jane@ecojourney.com | Content Manager</div>
                                    </div>
                                    <span
                                        style="background: #2ecc71; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px;">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="admin-categories" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h5 style="margin: 0;">Content Categories</h5>
                                    <button class="btn btn-primary" style="font-size: 12px;">+ Add Category</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="content-item">
                                    <div>
                                        <div class="content-title">Environmental</div>
                                        <div class="content-meta">8 content items | Color: #2ecc71</div>
                                    </div>
                                </div>
                                <div class="content-item">
                                    <div>
                                        <div class="content-title">Social</div>
                                        <div class="content-meta">7 content items | Color: #3498db</div>
                                    </div>
                                </div>
                                <div class="content-item">
                                    <div>
                                        <div class="content-title">Governance</div>
                                        <div class="content-meta">6 content items | Color: #f39c12</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="admin-settings" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5 style="margin: 0;">System Settings</h5>
                            </div>
                            <div class="card-body">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                        <input type="checkbox" checked>
                                        <span>Enable Email Notifications</span>
                                    </label>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                        <input type="checkbox">
                                        <span>Auto-publish Approved Content</span>
                                    </label>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                        <input type="checkbox">
                                        <span>Enable Interactive</span>
                                    </label>
                                </div>
                                <button class="btn btn-primary">Save Settings</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="profile" class="tab-content-area" style="display: none;">
                    <h1 class="page-title">My Profile</h1>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card" style="text-align: center;">
                                <div class="card-body">
                                    <div class="user-avatar"
                                        style="width: 80px; height: 80px; margin: 0 auto 15px; font-size: 32px;">
                                        A
                                    </div>
                                    <h5>Tom Smith</h5>
                                    <p style="color: #2ecc71; font-weight: 600; margin-bottom: 15px;"
                                        class="profile-role">Administrator</p>
                                    <hr>
                                    <p><strong>Email:</strong><br>tom@ecojourney.com</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 style="margin: 0;">Edit Profile Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">First
                                                Name</label>
                                            <input type="text" class="form-control">
                                        </div>
                                        <div class="col-md-6">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Last
                                                Name</label>
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label
                                            style="display: block; margin-bottom: 5px; font-weight: 600;">Organization</label>
                                        <input type="text" class="form-control">
                                    </div>
                                    <div class="mb-3">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Phone
                                            Number</label>
                                        <input type="tel" class="form-control">
                                    </div>
                                    <hr>
                                    <h6 style="margin-bottom: 15px; font-weight: 600;">Change Password</h6>
                                    <div class="mb-3">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Current
                                            Password</label>
                                        <input type="password" class="form-control">
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">New
                                                Password</label>
                                            <input type="password" class="form-control">
                                            <small style="color: #7f8c8d;">Min 8 chars, uppercase, lowercase, number,
                                                special char</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Confirm
                                                Password</label>
                                            <input type="password" class="form-control">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Preview Overlay -->
    <div id="previewOverlay" class="preview-overlay">
        <div class="preview-container">
            <div class="preview-header">
                <button class="preview-close-btn" onclick="closePreview()">
                    <i class="fas fa-times"></i>
                </button>
                <img src="https://www.moe.gov.sg/-/media/images/school-logos/post-secondary/republic-polytechnic.png?h=140&iar=0&w=500&hash=1EE0F782E863E3DB9FF95982A0BA8973"
                    alt="Republic Polytechnic Logo" class="preview-logo">
            </div>
            <div class="preview-content">
                <h1 class="preview-title" id="preview-title">Content Title</h1>

                <div class="preview-media" id="preview-media-container">
                    <img id="preview-image" style="display: none;" />
                    <video id="preview-video" controls style="display: none;"></video>
                    <div id="preview-no-media" style="color: #7f8c8d; padding: 40px; display: none;">
                        <i class="fas fa-image" style="font-size: 48px; margin-bottom: 10px;"></i>
                        <p>No media available for preview</p>
                    </div>
                </div>

                <div class="preview-description" id="preview-description">
                    No description available.
                </div>

                <div class="preview-meta">
                    <div class="preview-meta-item">
                        <i class="fas fa-tag"></i>
                        <strong>Category</strong>
                        <span id="preview-category">-</span>
                    </div>
                    <div class="preview-meta-item">
                        <i class="fas fa-calendar"></i>
                        <strong>Date</strong>
                        <span id="preview-date">-</span>
                    </div>
                    <div class="preview-meta-item">
                        <i class="fas fa-file"></i>
                        <strong>Type</strong>
                        <span id="preview-type">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Popup Modal -->
    <div id="confirmPopup" class="confirm-popup-overlay">
        <div class="confirm-popup">
            <div class="confirm-popup-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3>Delete Content?</h3>
            <p>Are you sure you want to delete this content? This action cannot be undone.</p>
            <div class="confirm-popup-buttons">
                <button class="confirm-popup-btn yes" onclick="confirmDelete(true)">Yes, Delete</button>
                <button class="confirm-popup-btn no" onclick="confirmDelete(false)">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Success Popup Modal -->
    <div id="successPopup" class="success-popup-overlay">
        <div class="success-popup">
            <div class="success-popup-icon">
                <i class="fas fa-check"></i>
            </div>
            <h3>Success!</h3>
            <p id="successPopupMessage">Content uploaded successfully!</p>
            <button class="success-popup-btn" onclick="closeSuccessPopup()">Great!</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="frontend/static/js/auth.js"></script>
    <script src="frontend/static/js/dashboard.js"></script>
    <script>
        // API Configuration
        const API_URL = 'https://rpecocjourney-backend.onrender.com';

        function showSuccessPopup(message) {
            const popup = document.getElementById('successPopup');
            const messageEl = document.getElementById('successPopupMessage');
            messageEl.textContent = message;
            popup.classList.add('show');
        }

        function closeSuccessPopup() {
            const popup = document.getElementById('successPopup');
            popup.classList.remove('show');
        }

        // Confirmation popup functions
        let pendingDeleteId = null;

        function showConfirmPopup(contentId) {
            pendingDeleteId = contentId;
            const popup = document.getElementById('confirmPopup');
            popup.classList.add('show');
        }

        async function confirmDelete(confirmed) {
            const popup = document.getElementById('confirmPopup');
            popup.classList.remove('show');

            if (confirmed && pendingDeleteId) {
                // Optimistic local delete: remove from DOM and local storage first
                try {
                    // Remove ALL elements with this data-id (may exist in both lists)
                    const contentItems = document.querySelectorAll(`[data-id="${pendingDeleteId}"]`);
                    if (contentItems && contentItems.length) {
                        contentItems.forEach(ci => ci.remove());
                    }

                    // Remove from IndexedDB if present
                    try {
                        await deleteContentFromStorage(pendingDeleteId);
                    } catch (e) {
                        console.warn('Failed to remove from local storage:', e);
                    }

                    // Update Recent, Approvals, and Dashboard
                    syncRecentFromYourContent();
                    syncApprovalsFromYourContent();
                    refreshDashboardStats();

                    // If viewing this content, go back to list
                    if (currentViewingContentId === pendingDeleteId) backToContentList();

                    showSuccessPopup('Content deleted successfully!');

                    // Attempt backend delete but don't block UI
                    try {
                        const response = await fetch(`${API_URL}/api/content/${pendingDeleteId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });

                        if (!response.ok) {
                            console.error('Server delete failed:', await response.text());
                            // Optionally notify user later; keep UI consistent for now
                        }
                    } catch (err) {
                        console.error('Failed to reach server for delete:', err);
                    }
                } catch (error) {
                    console.error('Failed to perform local delete:', error);
                    alert('Failed to delete content locally: ' + (error.message || error));
                }
            }

            pendingDeleteId = null;
        }

        // Content persistence functions using IndexedDB for large files
        let db;

        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('EcoJourneyDB', 1);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('contents')) {
                        db.createObjectStore('contents', { keyPath: 'id' });
                    }
                };
            });
        }

        function saveContentToStorage(content) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error('Database not initialized'));
                    return;
                }

                const transaction = db.transaction(['contents'], 'readwrite');
                const store = transaction.objectStore('contents');
                const request = store.put(content);

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        function getStoredContents() {
            return new Promise((resolve, reject) => {
                if (!db) {
                    resolve([]);
                    return;
                }

                const transaction = db.transaction(['contents'], 'readonly');
                const store = transaction.objectStore('contents');
                const request = store.getAll();

                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => reject(request.error);
            });
        }

        function deleteContentFromStorage(contentId) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    resolve();
                    return;
                }

                const transaction = db.transaction(['contents'], 'readwrite');
                const store = transaction.objectStore('contents');
                const request = store.delete(contentId);

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        function deleteContent(contentId) {
            showConfirmPopup(contentId);
        }

        function formatToSGTime(isoString) {
            if (!isoString) return '-';
            const date = new Date(isoString);
            // Format as "MMM DD, YYYY" (e.g., "Dec 17, 2025")
            const options = {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            };
            return date.toLocaleDateString('en-US', options);
        }

        function formatDateTime(isoString) {
            if (!isoString) return '-';
            const date = new Date(isoString);
            
            // Check if the date is valid
            if (isNaN(date.getTime())) return isoString;

            // Use en-SG to match Singapore time formatting
            return date.toLocaleString('en-SG', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }

        function formatContentId(id) {
            if (!id) return '-';
            
            // If it's a default ID (like "default-1"), return as is
            if (id.startsWith('default-')) {
                return id.toUpperCase();
            }
            
            // For UUID/MongoDB ObjectId format, show shortened version
            // Format: CONTENT-XXXXX (using first 8 characters)
            if (id.length > 12) {
                return 'CONTENT-' + id.substring(0, 8).toUpperCase();
            }
            
            return id.toUpperCase();
        }

        function formatFileSize(bytes) {
            if (!bytes || bytes === 0) return '0 KB';
            
            // If it's already formatted (contains 'KB', 'MB', 'GB'), return as is
            if (typeof bytes === 'string' && (bytes.includes('KB') || bytes.includes('MB') || bytes.includes('GB'))) {
                return bytes;
            }
            
            // Convert to number if string
            const numBytes = typeof bytes === 'string' ? parseInt(bytes) : bytes;
            
            if (numBytes < 1024) {
                return numBytes + ' bytes';
            } else if (numBytes < 1024 * 1024) {
                return (numBytes / 1024).toFixed(1) + ' KB';
            } else if (numBytes < 1024 * 1024 * 1024) {
                return (numBytes / (1024 * 1024)).toFixed(1) + ' MB';
            } else {
                return (numBytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
            }
        }

        async function loadStoredContents() {
            try {
                const response = await fetch(`${API_URL}/api/content/all`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    console.error('Failed to fetch contents from server');
                    return; // Silently fail and show default content
                }

                const contents = await response.json();
                const container = document.getElementById('content-items-container');

                if (!container) return;

                contents.forEach(content => {
                    const newRow = document.createElement('div');
                    newRow.className = 'content-item content-item-clickable';
                    newRow.setAttribute('data-id', content._id || content.id);
                    newRow.setAttribute('data-title', content.title);
                    newRow.setAttribute('data-type', content.type || 'Document');
                    newRow.setAttribute('data-size', content.fileSize);
                    newRow.setAttribute('data-date', content.date);
                    newRow.setAttribute('data-status', content.status || 'Pending');
                    newRow.setAttribute('data-category', content.category || 'General');
                    newRow.setAttribute('data-description', content.description || 'No description available.');
                    newRow.onclick = function () { viewContentDetail(this); };

                    const formattedDate = formatToSGTime(content.date);
                    const formattedSize = formatFileSize(content.fileSize);
                    newRow.innerHTML = `
                        <div>
                            <div class="content-title">${content.title}</div>
                            <div class="content-meta">${content.type || 'Document'} | ${formattedSize} | Modified: ${formattedDate}</div>
                        </div>
                        <div class="content-item-actions">
                            <span class="badge badge-warning">${content.status || 'Pending'}</span>
                            <button class="delete-btn" onclick="event.stopPropagation(); deleteContent('${content._id || content.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    container.insertBefore(newRow, container.firstChild);
                });
                // Sync top 3 items into Recent Content, approvals list, and dashboard stats
                syncRecentFromYourContent();
                syncApprovalsFromYourContent();
                refreshDashboardStats();
            } catch (error) {
                console.error('Failed to load contents:', error);
                // Silently fail and show default content instead of alerting
            }
        }

        function updateProfileRole() {
            const role = localStorage.getItem('user_role');
            if (!role) return;

            const roleDisplayNames = {
                admin: 'Administrator',
                producer: 'Content Producer',
                manager: 'Content Manager'
            };

            const roleText = roleDisplayNames[role] || '';

            const roleElements = document.getElementsByClassName('profile-role');
            for (let i = 0; i < roleElements.length; i++) {
                roleElements[i].textContent = roleText;
            }
        }

        const ROLE_PERMISSIONS = {
            admin: ['dashboard', 'admin', 'profile'],
            manager: ['dashboard', 'approvals', 'profile'],
            producer: ['dashboard', 'content', 'notifications', 'profile']
        };

        function switchTab(tabName) {
            const role = localStorage.getItem('user_role');

            if (!ROLE_PERMISSIONS[role]?.includes(tabName)) {
                alert('Access denied');
                return;
            }

            document.querySelectorAll('.tab-content-area').forEach(tab => {
                tab.style.display = 'none';
            });

            document.getElementById(tabName).style.display = 'block';

            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });

            document.getElementById('nav-' + tabName).classList.add('active');

        if (tabName === 'notifications') {
                const badge = document.getElementById('notification-count');
                if (badge) badge.style.display = 'none';
            }
        }

        function applyRolePermissions() {
            const role = localStorage.getItem('user_role');

            if (!role || !ROLE_PERMISSIONS[role]) {
                window.location.href = 'login.html';
                return;
            }

            // Get the allowed tabs for this role
            const allowedTabs = ROLE_PERMISSIONS[role];

            // First, hide ALL navigation links (except logout)
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                // Skip the logout button
                if (link.closest('.sidebar-footer')) return;

                // Default to hidden
                link.style.display = 'none';
            });

            // Then, ONLY show the allowed tabs for this role
            allowedTabs.forEach(tabName => {
                const navLink = document.getElementById('nav-' + tabName);
                if (navLink) {
                    navLink.style.display = 'block';
                }
            });

            switchTab(ROLE_PERMISSIONS[role][0]);
        }

        function switchAdminTab(tabName) {
            const adminTabs = document.querySelectorAll('[id^="admin-"]');
            adminTabs.forEach(tab => tab.style.display = 'none');
            document.getElementById('admin-' + tabName).style.display = 'block';

            document.querySelectorAll('.nav-tabs .nav-link').forEach(link => {
                link.classList.remove('active');
            });

            event.target.closest('.nav-link').classList.add('active');
        }

        function handleLogout(event) {
            event.preventDefault();
            logout();
        }

        function logout() {
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem('user_role');
            localStorage.removeItem('current_user');
            localStorage.removeItem('remember_me');
            localStorage.removeItem('remembered_username');
            window.location.href = 'login.html';
        }

        function showUploadForm() {
            document.getElementById('content-list').style.display = 'none';
            document.getElementById('upload-form-section').style.display = 'block';
            document.getElementById('content-detail-view').style.display = 'none';
            document.getElementById('content-edit-form').style.display = 'none';
        }

        function hideUploadForm() {
            document.getElementById('content-list').style.display = 'block';
            document.getElementById('upload-form-section').style.display = 'none';
            document.getElementById('content-detail-view').style.display = 'none';
            document.getElementById('content-edit-form').style.display = 'none';
            document.getElementById('upload-form').reset();
        }

        let currentViewingContentId = null;

        async function viewContentDetail(element) {
            const contentData = {
                id: element.dataset.id,
                title: element.dataset.title,
                type: element.dataset.type,
                size: element.dataset.size,
                date: element.dataset.date,
                status: element.dataset.status,
                category: element.dataset.category,
                description: element.dataset.description
            };

            currentViewingContentId = contentData.id;

            // Hide list and upload form, show detail view
            document.getElementById('content-list').style.display = 'none';
            document.getElementById('upload-form-section').style.display = 'none';
            document.getElementById('content-detail-view').style.display = 'block';
            document.getElementById('content-edit-form').style.display = 'none';

            // Populate detail view
            document.getElementById('detail-title').textContent = contentData.title;
            document.getElementById('detail-type').textContent = contentData.type;
            document.getElementById('detail-size').textContent = formatFileSize(contentData.size);
            document.getElementById('detail-date').textContent = formatToSGTime(contentData.date);
            document.getElementById('detail-category').textContent = contentData.category;
            document.getElementById('detail-status').textContent = contentData.status;
            document.getElementById('detail-description').textContent = contentData.description || 'No description available.';
            document.getElementById('detail-id').textContent = formatContentId(contentData.id);
            document.getElementById('detail-format').textContent = contentData.type;
            
                // Create a "Now" timestamp for Last Modified if you just edited it, 
                // otherwise use the stored date.
                const currentTime = new Date().toLocaleString('en-SG', {
                    timeZone: 'Asia/Singapore',
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });

                // Update the UI
                const uploadDateElement = document.getElementById('detail-upload-date');
                uploadDateElement.innerHTML = `
                    <div class="mb-2">
                        <strong class="text-dark">Upload Date:</strong> 
                        <span class="text-secondary">${formatDateTime(contentData.date)}</span>
                    </div>
                    <div>
                        <strong class="text-dark">Last Modified:</strong> 
                        <span class="text-secondary">${currentTime}</span>
                    </div>
                `;
            
            document.getElementById('detail-status-info').textContent = contentData.status;

            // Display media preview if available
            const mediaPreview = document.getElementById('detail-media-preview');
            const imagePreview = document.getElementById('detail-image-preview');
            const videoPreview = document.getElementById('detail-video-preview');

            // Reset display
            imagePreview.style.display = 'none';
            videoPreview.style.display = 'none';

            // Logic to fetch and display
            try {
                const contents = await getStoredContents();
                const localContent = contents.find(c => c.id === contentData.id);
                
                // Use data from local storage or fetch from server
                const displayData = localContent || await fetch(`${API_URL}/api/content/${contentData.id}`).then(r => r.json());

                if (displayData && displayData.mediaData) {
                    const mType = displayData.mediaFileType || "";
                    if (mType.startsWith('image/')) {
                        imagePreview.src = displayData.mediaData;
                        imagePreview.style.display = 'block';
                        videoPreview.style.display = 'none'; // Ensure video is hidden
                    } else if (mType.startsWith('video/')) {
                        videoPreview.src = displayData.mediaData;
                        videoPreview.style.display = 'block';
                        imagePreview.style.display = 'none'; // Ensure image is hidden
                    }
                    mediaPreview.style.display = 'block';
                } else {
                    mediaPreview.style.display = 'none'; // Hide if no media exists
                }
            } catch (e) {
                console.error("Preview failed", e);
            }
        }

        function backToContentList() {
            document.getElementById('content-list').style.display = 'block';
            document.getElementById('upload-form-section').style.display = 'none';
            document.getElementById('content-detail-view').style.display = 'none';
            document.getElementById('content-edit-form').style.display = 'none';
            currentViewingContentId = null;
        }

        function deleteCurrentContent() {
            if (currentViewingContentId) {
                showConfirmPopup(currentViewingContentId);
            }
        }

        async function downloadCurrentContent() {
            if (!currentViewingContentId) return;

            try {
                console.log('Downloading content ID:', currentViewingContentId);

                // Use backend download proxy route that handles filename correctly
                const downloadUrl = `${API_URL}/api/download/${currentViewingContentId}`;
                console.log('Download URL:', downloadUrl);

                // Open download in new window/tab
                window.open(downloadUrl, '_blank');

                showSuccessPopup('Download started!');
            } catch (error) {
                console.error('Download failed:', error);
                alert('Download failed: ' + error.message);
            }
        }

        async function previewContent() {
            if (!currentViewingContentId) return;

            // Open the detail page in a new tab, passing the ID
            const previewUrl = `content-detail.html?id=${currentViewingContentId}`;
            window.open(previewUrl, '_blank');
        }

        function closePreview() {
            document.getElementById('previewOverlay').classList.remove('show');
            document.body.style.overflow = ''; // Restore scrolling

            // Stop any playing video
            const previewVideo = document.getElementById('preview-video');
            if (previewVideo) {
                previewVideo.pause();
                previewVideo.currentTime = 0;
            }
        }

        async function editCurrentContent() {
            if (!currentViewingContentId) return;

            // Get the current content element
            const contentElement = document.querySelector(`[data-id="${currentViewingContentId}"]`);
            if (!contentElement) return;

            // Hide detail view, show edit form
            document.getElementById('content-detail-view').style.display = 'none';
            document.getElementById('content-edit-form').style.display = 'block';

            // Pre-fill the form
            document.getElementById('edit-title').value = contentElement.dataset.title;
            document.getElementById('edit-description').value = contentElement.dataset.description || '';
            document.getElementById('edit-category').value = contentElement.dataset.category || '';
            document.getElementById('edit-file').value = ''; // Clear file input
            document.getElementById('edit-media').value = ''; // Clear media input

            // Show current file info
            const currentFileInfo = document.getElementById('current-file-info');
            const currentFileDisplay = document.getElementById('current-file-display');
            const fileType = contentElement.dataset.type || 'Document';
            const fileSize = formatFileSize(contentElement.dataset.size) || 'Unknown';
            currentFileDisplay.textContent = `${fileType} (${fileSize})`;
            currentFileInfo.style.display = 'block';

            // Show current media if available
            const editCurrentMedia = document.getElementById('edit-current-media');
            const editCurrentImage = document.getElementById('edit-current-image');
            const editCurrentVideo = document.getElementById('edit-current-video');
            const editNewMediaPreview = document.getElementById('edit-new-media-preview');

            // Hide all media previews first
            editCurrentImage.style.display = 'none';
            editCurrentVideo.style.display = 'none';
            editCurrentMedia.style.display = 'none';
            editNewMediaPreview.style.display = 'none';

            // Only try to fetch from backend if it's NOT a default content item
            // Default content items (default-1, default-2, etc.) don't exist in the database
            const isDefaultContent = currentViewingContentId.startsWith('default-');
            
            if (!isDefaultContent) {
                try {
                    const response = await fetch(`${API_URL}/api/content/${currentViewingContentId}`);
                    const storedContent = response.ok ? await response.json() : null;

                    if (storedContent && storedContent.mediaData) {
                        const mediaFileType = storedContent.mediaFileType || '';

                        if (mediaFileType.startsWith('image/')) {
                            editCurrentImage.src = storedContent.mediaData;
                            editCurrentImage.style.display = 'block';
                            editCurrentMedia.style.display = 'block';
                        } else if (mediaFileType.startsWith('video/')) {
                            editCurrentVideo.src = storedContent.mediaData;
                            editCurrentVideo.style.display = 'block';
                            editCurrentMedia.style.display = 'block';
                        }
                    }
                } catch (error) {
                    console.warn('Could not fetch content from backend, continuing with edit:', error);
                    // Continue anyway - user can still edit title, description, and upload new files
                }
            } else {
                // For default content, show a message that they need to upload new media
                console.log('Editing default content - user can upload new media and document files');
            }

            // Add media file change listener for preview
            const mediaInput = document.getElementById('edit-media');
            mediaInput.onchange = function (e) {
                const file = e.target.files[0];
                const editNewImage = document.getElementById('edit-new-image');
                const editNewVideo = document.getElementById('edit-new-video');
                const editNewMediaPreviewDiv = document.getElementById('edit-new-media-preview');
                
                if (file) {
                    editNewImage.style.display = 'none';
                    editNewVideo.style.display = 'none';

                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function (evt) {
                            editNewImage.src = evt.target.result;
                            editNewImage.style.display = 'block';
                            editNewMediaPreviewDiv.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else if (file.type.startsWith('video/')) {
                        const reader = new FileReader();
                        reader.onload = function (evt) {
                            editNewVideo.src = evt.target.result;
                            editNewVideo.style.display = 'block';
                            editNewMediaPreviewDiv.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                } else {
                    editNewMediaPreviewDiv.style.display = 'none';
                }
            };
        }

        function cancelEdit() {
            document.getElementById('content-edit-form').style.display = 'none';
            document.getElementById('content-detail-view').style.display = 'block';
        }

        async function updateContentData(contentId, updatedData) {
            // 1. Update the DOM elements (Visual update)
            const contentElement = document.querySelector(`[data-id="${contentId}"]`);
            if (contentElement) {
                contentElement.dataset.title = updatedData.title;
                contentElement.dataset.description = updatedData.description;
                contentElement.dataset.category = updatedData.category;

                if (updatedData.fileSize) contentElement.dataset.size = updatedData.fileSize;
                if (updatedData.type) contentElement.dataset.type = updatedData.type;
                if (updatedData.date) contentElement.dataset.date = updatedData.date;

                const titleElement = contentElement.querySelector('.content-title');
                if (titleElement) titleElement.textContent = updatedData.title;

                if (updatedData.fileSize || updatedData.type || updatedData.date) {
                    const metaElement = contentElement.querySelector('.content-meta');
                    if (metaElement) {
                        const type = updatedData.type || contentElement.dataset.type;
                        const size = updatedData.fileSize || contentElement.dataset.size;
                        const date = updatedData.date || contentElement.dataset.date;
                        metaElement.textContent = `${type} | ${formatFileSize(size)} | Modified: ${formatToSGTime(date)}`;
                    }
                }
            }

            // 2. Update Storage (IndexedDB)
            try {
                const contents = await getStoredContents();
                const contentIndex = contents.findIndex(c => c.id === contentId);
                
                if (contentIndex !== -1) {
                    // BUG FIX: Merge existing data (like mediaData) with the new updates
                    // This ensures if only description changed, the old mediaData is kept.
                    const existingItem = contents[contentIndex];
                    const mergedData = { ...existingItem, ...updatedData };
                    
                    await saveContentToStorage(mergedData);
                } else {
                    const newEntry = { id: contentId, ...updatedData };
                    await saveContentToStorage(newEntry);
                }
            } catch (error) {
                console.error('Failed to update storage:', error);
            }

            // 3. Update the detail view UI immediately
            document.getElementById('detail-title').textContent = updatedData.title;
            document.getElementById('detail-category').textContent = updatedData.category;
            document.getElementById('detail-description').textContent = updatedData.description;

            if (updatedData.type) {
                document.getElementById('detail-type').textContent = updatedData.type;
                document.getElementById('detail-format').textContent = updatedData.type;
            }
            if (updatedData.fileSize) {
                document.getElementById('detail-size').textContent = formatFileSize(updatedData.fileSize);
            }
            if (updatedData.date) {
                document.getElementById('detail-date').textContent = formatToSGTime(updatedData.date);
                document.getElementById('detail-upload-date').textContent = formatDateTime(updatedData.date);
            }
        }

        window.addEventListener('DOMContentLoaded', async () => {
            // Initialize IndexedDB
            try {
                await initDB();
            } catch (error) {
                console.error('Failed to initialize database:', error);
                alert('Failed to initialize storage. Some features may not work properly.');
            }

            applyRolePermissions();
            updateProfileRole();
            await loadStoredContents(); // Load persisted content

            // Handle edit form submission
            const editForm = document.getElementById('edit-content-form');
            if (editForm) {
                editForm.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    try {
                        const title = document.getElementById('edit-title').value;
                        const description = document.getElementById('edit-description').value;
                        const category = document.getElementById('edit-category').value;
                        const newMediaFile = document.getElementById('edit-media').files[0];
                        const newDocFile = document.getElementById('edit-file').files[0];

                        if (!title || !category) {
                            alert('Please fill in title and category');
                            return;
                        }

                        // Check file sizes (500MB max)
                        const maxSize = 500 * 1024 * 1024; // 500MB in bytes
                        if (newMediaFile && newMediaFile.size > maxSize) {
                            alert('Media file is too large. Maximum size is 500MB.');
                            return;
                        }
                        if (newDocFile && newDocFile.size > maxSize) {
                            alert('Document file is too large. Maximum size is 500MB.');
                            return;
                        }

                        const updatedData = {
                            title: title,
                            description: description,
                            category: category
                        };

                        // If a new media file was uploaded, update media info
                        if (newMediaFile) {
                            const mediaData = await new Promise((resolve, reject) => {
                                const reader = new FileReader();
                                reader.onload = (e) => resolve(e.target.result);
                                reader.onerror = () => reject(new Error('Failed to read media file'));
                                reader.readAsDataURL(newMediaFile);
                            });

                            updatedData.mediaFileName = newMediaFile.name;
                            updatedData.mediaFileType = newMediaFile.type;
                            updatedData.mediaData = mediaData;
                        }

                        // If a new document file was uploaded, update document info
                        if (newDocFile) {
                            // Read the new document file data
                            const fileData = await new Promise((resolve, reject) => {
                                const reader = new FileReader();
                                reader.onload = (e) => resolve(e.target.result);
                                reader.onerror = () => reject(new Error('Failed to read document file'));
                                reader.readAsDataURL(newDocFile);
                            });

                            const fileSize = newDocFile.size < 1024 * 1024 ?
                                (newDocFile.size / 1024).toFixed(1) + ' KB' :
                                (newDocFile.size / (1024 * 1024)).toFixed(1) + ' MB';

                            // Determine file type from extension
                            const fileName = newDocFile.name.toLowerCase();
                            let fileType = 'Document';
                            if (fileName.endsWith('.pdf')) {
                                fileType = 'PDF';
                            } else if (fileName.endsWith('.doc') || fileName.endsWith('.docx')) {
                                fileType = 'Document';
                            }

                            updatedData.fileSize = fileSize;
                            updatedData.type = fileType;
                            updatedData.fileName = newDocFile.name;
                            updatedData.fileType = newDocFile.type;
                            updatedData.fileData = fileData;
                            updatedData.date = new Date().toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                year: 'numeric'
                            });
                        }

                        // Update the content
                        await updateContentData(currentViewingContentId, updatedData);

                        // Show success popup
                        let message = 'Content updated successfully!';
                        if (newMediaFile && newDocFile) {
                            message = 'Content, media, and document updated successfully!';
                        } else if (newMediaFile) {
                            message = 'Content and media updated successfully!';
                        } else if (newDocFile) {
                            message = 'Content and document updated successfully!';
                        }
                        showSuccessPopup(message);

                        // Refresh the detail view with updated media
                        if (newMediaFile) {
                            const contents = await getStoredContents();
                            const storedContent = contents.find(c => c.id === currentViewingContentId);

                            if (storedContent && storedContent.mediaData) {
                                const detailImage = document.getElementById('detail-image-preview');
                                const detailVideo = document.getElementById('detail-video-preview');
                                const detailMediaSection = document.getElementById('detail-media-preview');

                                // Hide all first (with null checks)
                                if (detailImage) detailImage.style.display = 'none';
                                if (detailVideo) detailVideo.style.display = 'none';

                                // Show the updated media
                                const mediaType = storedContent.mediaFileType || '';
                                if (mediaType.startsWith('image/') && detailImage) {
                                    detailImage.src = storedContent.mediaData;
                                    detailImage.style.display = 'block';
                                    if (detailMediaSection) detailMediaSection.style.display = 'block';
                                } else if (mediaType.startsWith('video/') && detailVideo) {
                                    detailVideo.src = storedContent.mediaData;
                                    detailVideo.style.display = 'block';
                                    if (detailMediaSection) detailMediaSection.style.display = 'block';
                                }
                            }
                        }

                        // Go back to detail view
                        document.getElementById('content-edit-form').style.display = 'none';
                        document.getElementById('content-detail-view').style.display = 'block';

                    } catch (error) {
                        console.error('Update failed:', error);
                        alert('Update failed: ' + error.message);
                    }
                });
            }

            // Handle upload form submission
            const uploadForm = document.getElementById('upload-form');
            if (uploadForm) {
                uploadForm.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    try {
                        // Get form values
                        const title = document.getElementById('content-title').value;
                        const description = document.getElementById('content-description').value;
                        const category = document.getElementById('content-category').value;
                        const mediaFile = document.getElementById('content-media').files[0];
                        const docFile = document.getElementById('content-file').files[0];

                        if (!title || !category) {
                            alert('Please fill in title and category');
                            return;
                        }

                        if (!mediaFile) {
                            alert('Please upload a media file (image or video)');
                            return;
                        }

                        if (!docFile) {
                            alert('Please upload a project document file');
                            return;
                        }

                        // Check file sizes (500MB max)
                        const maxSize = 500 * 1024 * 1024; // 500MB in bytes
                        if (mediaFile.size > maxSize) {
                            alert('Media file is too large. Maximum size is 500MB.');
                            return;
                        }
                        if (docFile.size > maxSize) {
                            alert('Document file is too large. Maximum size is 500MB.');
                            return;
                        }

                        // Show loading state
                        const submitBtn = uploadForm.querySelector('button[type="submit"]');
                        const originalText = submitBtn.innerHTML;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
                        submitBtn.disabled = true;

                        // Get file sizes
                        const docSize = docFile.size < 1024 * 1024 ?
                            (docFile.size / 1024).toFixed(1) + ' KB' :
                            (docFile.size / (1024 * 1024)).toFixed(1) + ' MB';

                        const today = new Date().toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric',
                            year: 'numeric'
                        });

                        // Determine document type
                        const docName = docFile.name.toLowerCase();
                        let docType = 'Document';
                        if (docName.endsWith('.pdf')) {
                            docType = 'PDF';
                        } else if (docName.endsWith('.doc') || docName.endsWith('.docx')) {
                            docType = 'Document';
                        }

                        // Create FormData to send files to Cloudinary
                        const formData = new FormData();
                        formData.append('title', title);
                        formData.append('description', description);
                        formData.append('category', category);
                        formData.append('type', docType);
                        formData.append('mediaFile', mediaFile); // Actual file object
                        formData.append('documentFile', docFile); // Actual file object

                        // Send to backend API with FormData (no Content-Type header needed)
                        const response = await fetch(`${API_URL}/api/content/upload`, {
                            method: 'POST',
                            body: formData // Send FormData directly
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'Upload failed');
                        }

                        const result = await response.json();
                        const contentId = result.content._id || result.content.id;

                        // Add new content to the list immediately
                        const contentList = document.getElementById('content-items-container');
                        if (contentList) {
                            const newRow = document.createElement('div');
                            newRow.className = 'content-item content-item-clickable';
                            newRow.setAttribute('data-id', contentId);
                            newRow.setAttribute('data-title', title);
                            newRow.setAttribute('data-type', docType);
                            newRow.setAttribute('data-size', docSize);
                            newRow.setAttribute('data-date', today);
                            newRow.setAttribute('data-status', 'Pending');
                            newRow.setAttribute('data-category', category);
                            newRow.setAttribute('data-description', description);
                            newRow.onclick = function () { viewContentDetail(this); };

                            newRow.innerHTML = `
                                <div>
                                    <div class="content-title">${title}</div>
                                    <div class="content-meta">${docType} | ${docSize} | Modified: ${today}</div>
                                </div>
                                <div class="content-item-actions">
                                    <span class="badge badge-warning">Pending</span>
                                    <button class="delete-btn" onclick="event.stopPropagation(); deleteContent('${contentId}')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `;
                            contentList.insertBefore(newRow, contentList.firstChild);
                            // Sync Recent, Approvals, and dashboard stats to reflect newly uploaded item
                            syncRecentFromYourContent();
                            syncApprovalsFromYourContent();
                            refreshDashboardStats();
                        }

                        // Reset button
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;

                        // Show success popup and switch to content tab
                        showSuccessPopup('Content uploaded successfully!');
                        hideUploadForm();
                        switchTab('content');

                    } catch (error) {
                        console.error('Upload failed:', error);
                        alert('Upload failed: ' + error.message);

                        // Reset button on error
                        const submitBtn = uploadForm.querySelector('button[type="submit"]');
                        submitBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Content';
                        submitBtn.disabled = false;
                    }
                });
            }
        });

        // Keep the "Recent Content" card in sync with the top 3 items from "Your Content"
        function syncRecentFromYourContent() {
            try {
                const yourContainer = document.getElementById('content-items-container');
                const recentContainer = document.getElementById('recent-content-container');
                if (!yourContainer || !recentContainer) return;

                // Clear existing recent items
                recentContainer.innerHTML = '';

                const items = yourContainer.querySelectorAll('.content-item');
                let added = 0;

                for (let i = 0; i < items.length && added < 3; i++) {
                    const item = items[i];
                    if (!item) continue;

                    const titleEl = item.querySelector('.content-title');
                    const metaEl = item.querySelector('.content-meta');
                    const badgeEl = item.querySelector('.badge');

                    const title = titleEl ? titleEl.textContent.trim() : (item.dataset.title || 'Untitled');
                    const meta = metaEl ? metaEl.textContent.trim() : `${item.dataset.type || ''} | ${item.dataset.size || ''} | Modified: ${item.dataset.date || ''}`;
                    const statusText = (item.dataset.status || (badgeEl ? badgeEl.textContent.trim() : '') || 'Pending');

                    let badgeClass = 'badge-warning';
                    const st = statusText.toLowerCase();
                    if (st.includes('approved') || st.includes('published')) badgeClass = 'badge-success';
                    else if (st.includes('rejected')) badgeClass = 'badge-danger';

                    const node = document.createElement('div');
                    node.className = 'content-item content-item-clickable';
                    // Mirror data attributes so viewContentDetail can use them
                    const srcId = item.getAttribute('data-id') || item.dataset.id || '';
                    // Use a distinct data-id for recent items so they are not removed when the original
                    // content item is deleted/approved. Preserve original id in data-src-id for lookups.
                    node.setAttribute('data-src-id', srcId);
                    if (srcId) node.setAttribute('data-id', 'recent-' + srcId);
                    node.setAttribute('data-title', item.getAttribute('data-title') || title);
                    node.setAttribute('data-type', item.getAttribute('data-type') || item.dataset.type || 'Document');
                    node.setAttribute('data-size', item.getAttribute('data-size') || item.dataset.size || '');
                    node.setAttribute('data-date', item.getAttribute('data-date') || item.dataset.date || '');
                    node.setAttribute('data-status', item.getAttribute('data-status') || item.dataset.status || statusText);
                    node.setAttribute('data-category', item.getAttribute('data-category') || item.dataset.category || '');
                    node.setAttribute('data-description', item.getAttribute('data-description') || item.dataset.description || '');

                    // When clicked from Dashboard recent list, open preview overlay instead
                    node.onclick = function () { openPreviewFromElement(this); };

                    node.innerHTML = `
                        <div>
                            <div class="content-title">${title}</div>
                            <div class="content-meta">${meta}</div>
                        </div>
                        <span class="badge ${badgeClass}">${statusText}</span>
                    `;

                    recentContainer.appendChild(node);
                    added++;
                }
            } catch (e) {
                console.error('syncRecentFromYourContent error:', e);
            }
        }

        // Sync pending items from 'Your Content' into the Approvals queue
        function syncApprovalsFromYourContent() {
            try {
                const yourContainer = document.getElementById('content-items-container');
                const approvalsContainer = document.getElementById('approvals-container');
                if (!yourContainer || !approvalsContainer) return;

                // Clear current approvals list
                approvalsContainer.innerHTML = '';

                const items = yourContainer.querySelectorAll('.content-item');
                let added = 0;

                items.forEach(item => {
                    const status = (item.getAttribute('data-status') || item.dataset.status || '').toString().toLowerCase();
                    if (!status.includes('pending')) return;

                    const title = item.getAttribute('data-title') || item.dataset.title || 'Untitled';
                    const date = item.getAttribute('data-date') || item.dataset.date || '-';
                    const category = item.getAttribute('data-category') || item.dataset.category || '-';
                    const author = item.getAttribute('data-author') || item.dataset.author || localStorage.getItem('current_user') || 'Unknown';
                    const id = item.getAttribute('data-id') || item.dataset.id || '';
                    const description = item.getAttribute('data-description') || item.dataset.description || '';

                    const node = document.createElement('div');
                    node.className = 'content-item';
                    node.setAttribute('data-id', id);
                    node.setAttribute('data-title', title);
                    node.setAttribute('data-author', author);
                    node.setAttribute('data-date', date);
                    node.setAttribute('data-category', category);
                    node.setAttribute('data-description', description);
                    node.setAttribute('data-status', 'Pending');

                    node.innerHTML = `
                        <div>
                            <div class="content-title">${title}</div>
                            <div class="content-meta">Submitted by: ${author} | ${date} | Category: ${category}</div>
                        </div>
                        <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">
                            <i class="fas fa-eye"></i> Review
                        </button>
                    `;

                    // Attach review handler
                    const btn = node.querySelector('button');
                    if (btn) {
                        btn.onclick = function (e) {
                            e.stopPropagation();
                            openReviewPage(node);
                        };
                    }

                    approvalsContainer.appendChild(node);
                    added++;
                });

                // Update pending count and badges
                updateApprovalsList();
            } catch (e) {
                console.error('syncApprovalsFromYourContent error:', e);
            }
        }

        // Open preview overlay using data attributes from a content element (used on Dashboard recent items)
        async function openPreviewFromElement(element) {
            try {
                if (!element) return;
                // Prefer original source id if present (recent items use data-src-id)
                const id = element.getAttribute('data-src-id') || element.getAttribute('data-id') || element.dataset.id;
                const title = element.getAttribute('data-title') || element.dataset.title || 'No Title';
                const description = element.getAttribute('data-description') || element.dataset.description || 'No description available.';
                const category = element.getAttribute('data-category') || element.dataset.category || '-';
                const date = element.getAttribute('data-date') || element.dataset.date || '-';
                const type = element.getAttribute('data-type') || element.dataset.type || '-';

                // Set preview text
                document.getElementById('preview-title').textContent = title;
                document.getElementById('preview-description').textContent = description;
                document.getElementById('preview-category').textContent = category;
                document.getElementById('preview-date').textContent = formatToSGTime(date);
                document.getElementById('preview-type').textContent = type;

                // Prepare media placeholders
                const previewImage = document.getElementById('preview-image');
                const previewVideo = document.getElementById('preview-video');
                const previewNoMedia = document.getElementById('preview-no-media');
                previewImage.style.display = 'none';
                previewVideo.style.display = 'none';
                previewNoMedia.style.display = 'none';

                let mediaFound = false;

                // 1. Try Local Storage (IndexedDB) first
                if (id) {
                    try {
                        const contents = await getStoredContents();
                        const localContent = contents.find(c => c.id === id);
                        
                        if (localContent && localContent.mediaData) {
                            const mediaType = localContent.mediaFileType || '';
                            console.log('Preview element - Found local media, type:', mediaType);
                            
                            if (mediaType.startsWith('image/')) {
                                previewImage.src = localContent.mediaData;
                                previewImage.style.display = 'block';
                                mediaFound = true;
                            } else if (mediaType.startsWith('video/')) {
                                previewVideo.src = localContent.mediaData;
                                previewVideo.style.display = 'block';
                                mediaFound = true;
                            }
                        }
                    } catch (e) {
                        console.warn('Local preview check failed:', e);
                    }

                    // 2. If not found locally, try Backend
                    if (!mediaFound && !id.startsWith('default-')) {
                        try {
                            const response = await fetch(`${API_URL}/api/content/${id}`);
                            if (response.ok) {
                                const stored = await response.json();
                                if (stored && stored.mediaData) {
                                    const mediaType = stored.mediaFileType || '';
                                    console.log('Preview element - Found backend media, type:', mediaType);
                                    
                                    if (mediaType.startsWith('image/')) {
                                        previewImage.src = stored.mediaData;
                                        previewImage.style.display = 'block';
                                        mediaFound = true;
                                    } else if (mediaType.startsWith('video/')) {
                                        previewVideo.src = stored.mediaData;
                                        previewVideo.style.display = 'block';
                                        mediaFound = true;
                                    }
                                }
                            }
                        } catch (err) {
                            console.error('openPreviewFromElement fetch error:', err);
                        }
                    }
                }

                // 3. If still no media, show "No Media"
                if (!mediaFound) {
                    previewNoMedia.style.display = 'block';
                }

                // Show preview overlay
                document.getElementById('previewOverlay').classList.add('show');
                document.body.style.overflow = 'hidden';
                // Set currentViewingContentId for any further actions
                currentViewingContentId = id || null;
            } catch (e) {
                console.error('openPreviewFromElement error:', e);
            }
        }

        // Refresh dashboard statistics: Total, Approved, Pending, Rejected
        function refreshDashboardStats() {
            try {
                const container = document.getElementById('content-items-container');
                if (!container) return;

                const items = Array.from(container.querySelectorAll('.content-item'));
                const totals = {
                    total: items.length,
                    approved: 0,
                    pending: 0,
                    rejected: 0
                };

                items.forEach(item => {
                    const ds = (item.getAttribute('data-status') || item.dataset.status || '').toString().toLowerCase();
                    const badge = item.querySelector('.badge');
                    const badgeText = badge ? badge.textContent.toLowerCase() : '';
                    const statusText = ds || badgeText || '';

                    if (statusText.includes('approved') || statusText.includes('published')) {
                        totals.approved++;
                    } else if (statusText.includes('rejected')) {
                        totals.rejected++;
                    } else {
                        // Treat everything else as pending
                        totals.pending++;
                    }
                });

                const statCards = document.querySelectorAll('.stat-card');
                if (statCards && statCards.length >= 4) {
                    const totalStat = statCards[0].querySelector('.stat-info h3');
                    const approvedStat = statCards[1].querySelector('.stat-info h3');
                    const pendingStat = statCards[2].querySelector('.stat-info h3');
                    const rejectedStat = statCards[3].querySelector('.stat-info h3');

                    if (totalStat) totalStat.textContent = String(totals.total);
                    if (approvedStat) approvedStat.textContent = String(totals.approved);
                    if (pendingStat) pendingStat.textContent = String(totals.pending);
                    if (rejectedStat) rejectedStat.textContent = String(totals.rejected);
                }
            } catch (e) {
                console.error('refreshDashboardStats error:', e);
            }
        }
    </script>
</body>

</html>
